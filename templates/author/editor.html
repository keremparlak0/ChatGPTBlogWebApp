<!-- Editor sayfası -->
{% extends "layout.html" %}
{% load static %}


{% block title %} Editor {% endblock title %} Editor

{% block content %}
<form method="post">
    {% csrf_token %}
    {{form.as_p}}

    <input id="submitButton" type="submit" value="Submit">
</form>
<div>
    <a href="{% url 'publishDraft' draft.draft_id %}" class="btn btn-primary"> Yayınla </a>
</div>

<div class="advice-div">

</div>

<script type="text/javascript" src="{% static " ckeditor/ckeditor-init.js" %}"></script>
<script type="text/javascript" src="{% static " ckeditor/ckeditor/ckeditor.js" %}"></script>
<script>
    // const ckeditorDiv = document.querySelector('.django-ckeditor-widget');
    const API_KEY = 'APIKEY'
    const form = document.querySelectorAll('form')[1];
    const content = form.querySelector('#id_content');
    const adviceDiv = document.querySelector('.advice-div')
    const getAdvice = async (e) => {
        if (e.key === 'Enter') {
            // e.preventDefault()
            console.log(content.value);

            try {
                const response = await fetch('https://api.openai.com/v1/completions', {
                    method: "POST",
                    headers: {
                        "Authorization": `Bearer ${API_KEY}`,
                        "Content-Type": "application/json"
                    },
                    body: JSON.stringify({
                        "model": "text-davinci-003",
                        "prompt": `${content.value} bu konu hakkında en fazla 100 karakterlik öneri yazısı yaz. Tek paragraf olsun ve kısa olsun`,
                        "temperature": 0.9,
                        "max_tokens": 150,
                        "top_p": 1,
                        "frequency_penalty": 0.0,
                        "presence_penalty": 0.6,
                        "stop": [" Human:", " AI:"]
                    })
                });
                const data = await response.json();
                console.log(data.choices[0].text);

                const adviceText = document.createElement('p');
                adviceText.textContent = data.choices[0].text;
                adviceDiv.append(adviceText);


            } catch (error) {
                console.log(error);
            }
        }
    }

    content.addEventListener('keypress', getAdvice);
</script>
<!-- <script>
    const API_KEY = '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'
    const form = document.querySelectorAll('form')[1]
    const title = form.querySelector('#id_title')
    const aiAdvice = (e) => {
        if (e.key === 'Enter') {
            e.preventdefault()
            console.log(title.value);
        }
    }

    title.addEventListener('keypress', aiAdvice)
</script> -->
{% endblock content %}